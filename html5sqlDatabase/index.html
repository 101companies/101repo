<!DOCTYPE HTML>
<!-- This is the code for the 101companies application written in HTML 5 & JavaScript -->

<!-- CLIENT-SIDE, SESSION-STORAGE -->
<html>
<head>

<script type="text/javascript">
// -------------------------------------------------------------------------------------------------------------- create DATABASE
var db = openDatabase('101companies', '1.0', 'companies database', 2 * 1024 * 1024);

// -------------------------------------------------------------------------------------------------------------- create TABLES for 101companies
function createTables() {
	// create tables for:
	db.transaction(function (tx) {
		tx.executeSql('DROP TABLE Company');
		tx.executeSql('DROP TABLE Department');
		tx.executeSql('DROP TABLE Employee');
	
		// company
		tx.executeSql('CREATE TABLE IF NOT EXISTS Company (id UNIQUE, name)');
		
		// department
		tx.executeSql('CREATE TABLE IF NOT EXISTS Department (id UNIQUE, name, cid, did)');
		
		// employee
		tx.executeSql('CREATE TABLE IF NOT EXISTS Employee (id UNIQUE, name, address, salary, manager, cid, did)');
	});
}

// -------------------------------------------------------------------------------------------------------------- create DATA for 101companies
function createCompanies() {
	// create data for companies
	db.transaction(function (tx) {
		tx.executeSql('INSERT INTO Company (id, name) VALUES (0, "Meganalysis")');
	});
}

function createDepartments() {
	// create data for departments
	db.transaction(function (tx) {
		tx.executeSql('INSERT INTO Department (id, name, cid) VALUES (0, "Research", 0)');
		tx.executeSql('INSERT INTO Department (id, name, cid) VALUES (1, "Development", 0)');
		tx.executeSql('INSERT INTO Department (id, name, did) VALUES (2, "Dev1", 1)');
		tx.executeSql('INSERT INTO Department (id, name, did) VALUES (3, "Dev1.1", 2)');
	});
}

function createEmployees() {
	// create data for employees
	db.transaction(function (tx) {
		tx.executeSql('INSERT INTO Employee (id, name, address, salary, manager, cid, did) VALUES (0, "Craig", "Redmond", 123456, 1, 1, 1)');
		tx.executeSql('INSERT INTO Employee (id, name, address, salary, manager, cid, did) VALUES (1, "Ray", "Redmond", 234567, 1, 1, 2)');
		tx.executeSql('INSERT INTO Employee (id, name, address, salary, manager, cid, did) VALUES (2, "Klaus", "Boston", 23456, 1, 1, 3)');
		tx.executeSql('INSERT INTO Employee (id, name, address, salary, manager, cid, did) VALUES (3, "Karl", "Riga", 2345, 1, 1, 4)');
		tx.executeSql('INSERT INTO Employee (id, name, address, salary, manager, cid, did) VALUES (4, "Erik", "Utrecht", 12345, 0, 1, 1)');
		tx.executeSql('INSERT INTO Employee (id, name, address, salary, manager, cid, did) VALUES (5, "Ralf", "Koblenz", 1234, 0, 1, 1)');
		tx.executeSql('INSERT INTO Employee (id, name, address, salary, manager, cid, did) VALUES (6, "Joe", "Wifi City", 2344, 0, 1, 4)');
	});
}

function createData() {
	// create data for the company
	createCompanies();
	createDepartments();
	createEmployees();
}

// -------------------------------------------------------------------------------------------------------------- Create SELECTIONS

function selectDepartments(id, name) {
	db.transaction(function (tx) {
		tx.executeSql('SELECT * FROM Department WHERE cid = ' + id, [], function (tx, results) {
			var code = "<h3>" + name + "</h3>";
		
			var len = results.rows.length, i;
			var departments = "Departments: <br>";
			for (var i = 0; i < len; i++) {
				departments += "<input type=\"button\" name=\"" 
					+ results.rows.item(i).name 
					+ "\" value=\"" 
					+ results.rows.item(i).name 
					+ "\"><br>";
				
			}
			code += departments;
			
			code += "<br><input type=\"button\" name=\"back\" value=\"back\" onclick=\"selectCompanies()\">";
			document.querySelector('#headline').innerHTML = code;
			document.display.display.value = departments;
		}, null);
	});	
}

function selectCompanies() {
	db.transaction(function (tx) {
		tx.executeSql('SELECT * FROM Company', [], function (tx, results) {
			var len = results.rows.length, i;
			var companies = "Companies: <br>";
			for (var i = 0; i < len; i++) {
				companies += "<input type=\"button\" name=\"" 
					+ results.rows.item(i).name 
					+ "\" value=\"" 
					+ results.rows.item(i).name 
					+ "\" onclick=\"selectDepartments('" 
					+ results.rows.item(i).id 
					+ "', '" 
					+ results.rows.item(i).name 
					+ "')\">";
				
			}
			document.querySelector('#headline').innerHTML = companies;
			document.display.display.value = companies;
		}, null);
	});
}

  
</script> 

</head>
<body>

<center>

<h1>101companies HTML 5 WebApp</h1>

<form name="display">
<textarea name="display"></textarea>
</form>  

<script>
// -------------------------------------------------------------------------------------------------------------- INIT
createTables();
createData();
selectCompanies();

// -------------------------------------------------------------------------------------------------------------- Create PAGE
// Companies
</script>

<div id="headline" name="headline"></div>

</center>

</body>
</html> 