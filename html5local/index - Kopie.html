<!DOCTYPE HTML>
<!-- This is the code for the 101companies application written in HTML 5 & JavaScript -->

<!-- CLIENT-SIDE, SESSION-STORAGE -->
<html>
<head>
<script type="text/javascript">
// ------------------------------------------------------------------------ Creating some objects for 101companies
var storageObject = localStorage;
var currentDepartments;
var currentEmployees;
var currentEmployee;

var main = {};

function HistoryElement(company) {
	this.company = company;
}

function loadData() {
	// If the company does not exist, it must be created locally.
	if (storageObject.company == null) {
		// create company ...
		var company = new Company("Meganalysis");

		// create departments ...
		var research = new Department("Research");
		var development = new Department("Development");
		var development1 = new Department("Dev 1");
		var development11 = new Department("Dev 1.1");

		// insert departments ...
		company.departments.push(research);
		company.departments.push(development);
		development.subdepartments.push(development1);
		development1.subdepartments.push(development11);

		// create employees ...
		var craig = new Employee("Craig", "Redmond", 123456.0, true);
		var eric = new Employee("Eric", "Utrecht", 12345.0, false);
		var ralf = new Employee("Ralf", "Koblenz", 1234.0, false);
		var ray = new Employee("Ray", "Redmond", 234567.0, true);
		var klaus = new Employee("Klaus", "Boston", 23456.0, true);
		var karl = new Employee("Karl", "Riga", 2345.0, true);
		var joe = new Employee("Joe", "Wifi City", 2344.0, false);
		
		// insert employees ...
		research.employees.push(craig);
		research.employees.push(eric);
		research.employees.push(ralf);
		
		development.employees.push(ray);
		
		development1.employees.push(klaus);
		
		development11.employees.push(karl);
		development11.employees.push(joe);

		// save company
		storageObject.setItem('company', JSON.stringify(company));
	}
	return JSON.parse(storageObject.getItem('company'));
}

function back(fromEmployee) {
	var length = main.history.depList.length;
	
	if (fromEmployee == 1) {
		selectDepartment(main.history.depList.pop());
	} else {
		if (length > 1) {
			main.history.depList.pop();
			selectDepartment(main.history.depList.pop());
		} else {
			selectDepartmentsForCompany(main.history.company);
		}
	}
}

function setName(newName) {
	alert(newName);
	currentEmployee.name = newName;
}

function setAddress(newAddress) {
	currentEmployee.address = newAddress;
}

function setSalary(newSalary) {
	currentEmployee.salary = newSalary;
}

function selectEmployee(empNumber) {
	var currentEmployee = currentEmployees[empNumber];
	
	var employee = "Name:<br><input name=\"name\" type=\"text\" size=\"30\" maxlength=\"30\" value=\"" + currentEmployee.name + "\" onchange=\"setName(this.value)\"><br>";
	employee += "Address:<br><input name=\"address\" type=\"text\" size=\"30\" maxlength=\"30\" value=\"" + currentEmployee.address + "\" onchange=\"setAddress(this.value)\"><br>";
	employee += "Salary:<br><input name=\"salary\" type=\"text\" size=\"30\" maxlength=\"30\" value=\"" + currentEmployee.salary + "\" onchange=\"setSalary(this.value)\"><br>";
			
	document.querySelector('#subheadline').innerHTML = "<h3> Employee: " + currentEmployee.name + "</h3>";
	document.querySelector('#departments').innerHTML = "";
	document.querySelector('#employees').innerHTML = employee;
	document.querySelector('#total').innerHTML = "";
	document.querySelector('#back').innerHTML = "<br><input type=\"button\" name=\"back\" value=\"back\" onclick=\"back(1)\">";
}

function selectDepartmentWithNumber(depNumber) {
	var department = currentDepartments[depNumber];
	selectDepartment(department);
}

function selectDepartment(department) {
	document.querySelector('#subheadline').innerHTML = "<h3> Department: " + department.name + "</h3>";
	
	currentDepartments = department.subdepartments;
	currentEmployees = department.employees;
	
	var departments = "Departments: <br>";
	departments += "<form action=\"select1.htm\">";
	departments += "<p>";
	departments += "<select name=\"Departments\" size=\"5\" STYLE=\"width:100px;\">";
	
	var len = department.subdepartments.length;
	for (var i = 0; i < len; i++) {
		if(i == 0) {
			departments += "<option value=\"" + i + "\" selected>";
		} else {
			departments += "<option value=\"" + i + "\">";
		}
		departments += department.subdepartments[i].name + "</option>";
		
	}
	
	departments += "</select>";
	departments += "</p>";
			
	departments += "<input type=\"button\" value=\"select\" onclick=\"selectDepartmentWithNumber(this.form.Departments.options[this.form.Departments.selectedIndex].value)\" >";
	departments += "</form>";
			
	document.querySelector('#departments').innerHTML = departments;
	
	var lenEmp = department.employees.length;
	var employees = "Employees: <br>";
	var manager = "Manager: <br>";
	var employeeTemp = "";
	
	employees += "<form action=\"select1.htm\">";
	employees += "<p>";
	employees += "<select name=\"Employees\" size=\"5\" STYLE=\"width:100px;\">";
	
	var elementSelected = false;
	
	for (var i = 0; i < lenEmp; i++) {
		if (department.employees[i].manager == false) {
			if(elementSelected == false) {
				employees += "<option value=\"" + i + "\" selected>";
				elementSelected = true;
			} else {
				employees += "<option value=\"" + i + "\">";
			}
			employees += department.employees[i].name + "</option>";
		} else {
			manager += "<input type=\"button\" name=\""
				+ department.employees[i].name
				+ "\" value=\"" 
				+ department.employees[i].name
				+ "\" onclick=\"selectEmployee('" 
				+ i
				+ "')\"><br>";
		}
	}
	employees += "</select>";
	employees += "</p>";
			
	employees += "<input type=\"button\" value=\"select\" onclick=\"selectEmployee(this.form.Employees.options[this.form.Employees.selectedIndex].value)\" >";
	employees += "</form>";

	document.querySelector('#employees').innerHTML = manager + employees;
	document.querySelector('#back').innerHTML = "<br><input type=\"button\" name=\"back\" value=\"back\" onclick=\"back(0)\">";
	
	var total = totalDepartment(department);
	document.querySelector('#total').innerHTML = "<br>Total: " + total + "<input type=\"button\" name=\"cut\" value=\"cut\" onclick=\"cutAll()\">";
	
	if (main.history.depList) {
		main.history.depList.push(department);
	} else {
		main.history.depList = new Array(department);
	}
}

function selectDepartmentsForCompany(company) {
	main.history = new HistoryElement(company);
	
	document.querySelector('#headline').innerHTML = "<h2> Company: " + company.name + "</h2>";
	document.querySelector('#subheadline').innerHTML = "";
	
	var departments = "Departments: <br>";
	departments += "<form action=\"select1.htm\">";
	departments += "<p>";
	departments += "<select name=\"Departments\" size=\"5\" STYLE=\"width:100px;\">";
	
	currentDepartments = company.departments;
	var len = company.departments.length;
	for (var i = 0; i < len; i++) {
		if(i == 0) {
			departments += "<option value=\"" + i + "\" selected>";
		} else {
			departments += "<option value=\"" + i + "\">";
		}
		departments += company.departments[i].name + "</option>";
		
	}
	
	departments += "</select>";
	departments += "</p>";
			
	departments += "<input type=\"button\" value=\"select\" onclick=\"selectDepartmentWithNumber(this.form.Departments.options[this.form.Departments.selectedIndex].value)\" >";
	departments += "</form>";

	document.querySelector('#departments').innerHTML = departments;
	document.querySelector('#employees').innerHTML = "";
	document.querySelector('#back').innerHTML = "";

	var total = totalCompany(company);
	document.querySelector('#total').innerHTML = "<br>Total: " + total + "<input type=\"button\" name=\"cut\" value=\"cut\" onclick=\"cutAll()\">";
}

function totalCompany(company) {
	var total = 0;
	var len = company.departments.length;
	for (var i = 0; i < len; i++) {
		total += totalDepartment(company.departments[i]);
	}
	return total;
}

function totalDepartment(department) {
	var total = 0;
	var len = department.subdepartments.length;
	for (var i = 0; i < len; i++) {
		total += totalDepartment(department.subdepartments[i]);
	}
	var lenEmp = department.employees.length;
	for (var i = 0; i < lenEmp; i++) {
		total += department.employees[i].salary;
	}
	return total;
}

</script> 

</head>
<body>

<center>

<h1>101companies HTML 5 WebApp</h1>

<div id="headline" name="headline"></div><br>
<hr/>
<div id="subheadline" name="subheadline"></div><br>
<div id="employees" name="employees"></div><br>
<div id="departments" name="departments"></div><br>
<hr/>
<div id="total" name="total"></div><br>
<hr/>
<div id="back" name="back"></div><br><br><br>
<div id="test" name="test"></div>

<script>
// ------------------------------------------------------------------------ Creating the classes for 101companies

/*
 * Class: Company 
 *
 * A company has a name and contains several departments.
 */
function Company (name) {
	this.name = name;
	this.departments = new Array();
}

/*
 * Class: Department 
 *
 * A department has a name and contains several employees. It is part of a company.
 */ 
function Department (name) {
	this.name = name;
	this.employees = new Array();
	this.subdepartments = new Array();
}

/*
 * Class: Employee
 *
 * An Employee has a name, address and salary. He is part of a department.
 */
function Employee (name, address, salary, manager) {
	this.name = name;
	this.address = address;
	this.salary = salary;
	this.manager = manager;
}

// -------------------------------------------------------------------------------------------------------------- INIT
var savedCompany = loadData();
var history = new HistoryElement();
selectDepartmentsForCompany(savedCompany);

</script> 

</center>

</body>
</html> 